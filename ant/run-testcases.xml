<?xml version="1.0" encoding="UTF-8"?>
<project default="run" basedir="." name="Lucee">

<macrodef name="echots">
	<attribute name="message"/>
	<sequential>
	  <local name="timestamp" />
	  <tstamp>
		<format property="timestamp" pattern="yyyy-MM-dd HH:mm:ss" />
	  </tstamp>
	  <echo message="---------- ${timestamp} - @{message} ----------" />
	</sequential>
  </macrodef>

<target name="run">

<echo><![CDATA[
  _____         _   ____
 |_   _|__  ___| |_| __ )  _____  __
   | |/ _ \/ __| __|  _ \ / _ \ \/ /
   | |  __/\__ \ |_| |_) | (_) >  <
   |_|\___||___/\__|____/ \___/_/\_\

]]></echo>
<echots message="start TestBox testcases"/>

<!-- TODO this is hard to debug, any errors, it just fails with zero feedback -->
<script language="CFML">
<![CDATA[

systemOutput("---------- #DateTimeFormat(now(),'yyyy-mm-dd HH:nn:ss')# - Lucee Started ----------", true);

try {
	// errors in this template don't get a stacktrace, java just dumps out with err =1 
	systemOutput(expandPath( ".\run-testcases.cfm" ), true);

	cfinclude( template = "run-testcases.cfm"); 
	systemOutput("finished!", true);
} catch(e){
	/*
	NL = "
";
	echo("-------------------------------------------------------" & NL);
	echo("Testcase failed:" & NL);
	echo( e.message & NL);
	echo( ReReplace( Serialize(e), "[\r\n]\s*([\r\n]|\Z)", Chr(10), "ALL" ) & NL); // avoid too much whitespace from dump
	echo("-------------------------------------------------------" & NL);
	rethrow;
	*/
}
]]>
</script>

</target>
</project>
